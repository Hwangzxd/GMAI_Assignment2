tree("Root")
	repeat
		fallback
			tree("Reload")
			tree("Attack")
			tree("Roaming")


tree("Idle")
	repeat
		fallback
			sequence
				IsVisible_Player
				PlayerHasMarkedTreasure
				tree("Chase")
			sequence 
				IsVisible_Player
				tree("Attack")
			sequence
				random
					SetTarget_Angle(90.0)
					SetTarget_Angle(-90.0)
					SetTarget_Angle(135.0)
					SetTarget_Angle(-135.0)
				AimAt_Target
				Wait(2.0)


tree("Roaming")
	repeat
		fallback
			sequence
				IsVisible_Treasure
				tree("GoToTreasure")
			sequence
				SetDestination_Waypoint
				SetTarget_Destination
				AimAt_Target
				MoveTo_Destination
				Wait(0.3)
				NextWaypoint
		

tree("Attack")
	fallback
		repeat
			sequence
				IsVisible_Player
				HasAmmo
				Stop
				Wait(0.5)
				AimAt_Target
				tree("Fire")
		sequence
			Clear_Enemy
			Fail


tree("Fire")
	sequence
		Wait(0.3)
		Fire


tree("Reload")
	while Ammo_LessThan(3)
		sequence
			not HasAmmo
			Stop
			Wait(2.0)
			Succeed


// New task to check for treasure and set destination
tree("GoToTreasure")
	sequence
		SetDestination_Treasure
		PickUp
		tree("ReturnToNest")


tree("ReturnToNest")
	sequence
		SetDestination_Nest
		Drop
		tree("Idle")


tree("Chase")
	repeat
		sequence
			SetDestination_Enemy
			IsVisible_Player
			HasAmmo
			Stop
			Wait(0.5)
			AimAt_Target
			tree("Fire")